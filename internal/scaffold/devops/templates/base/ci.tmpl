{{- if eq .CI "github-actions" }}
name: CI
on:
  push:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest	
    steps:
      - uses: actions/checkout@v4
    {{- if eq .Language "go" }}
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: 1.22
      - name: Build
        run: go build -v ./...
    {{- else if eq .Language "python" }}
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.10
      - name: Install dependencies
        run: pip install -r requirements.txt
    {{- else if eq .Language "js" }}
      - name: Install dependencies
        run: npm install
      - name: Build
        run: npm run build
    {{- else if eq .Language "ts" }}
      - name: Install dependencies
        run: npm install
      - name: Build
        run: npm run build
    {{- end }}
{{- else if eq .CI "gitlab-ci" }}
stages:
  - build

build:
  stage: build
  image: ubuntu:latest
  only:
    - main
  before_script:
    - apt update && apt install -y curl

  script:
    - echo "Checking out code..."
    - git clone $CI_REPOSITORY_URL .

    {{- if eq .Language "go" }}
    - echo "Setting up Go"
    - apt install -y golang
    - go version
    - go build -v ./...
    {{- else if eq .Language "python" }}
    - echo "Setting up Python"
    - apt install -y python3 python3-pip
    - python3 --version
    - pip3 install -r requirements.txt
    {{- else if eq .Language "js" }}
    - echo "Setting up Node.js"
    - curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
    - apt install -y nodejs
    - node -v
    - npm install
    - npm run build
    {{- else if eq .Language "ts" }}
    - echo "Setting up Node.js (for TS)"
    - curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
    - apt install -y nodejs
    - node -v
    - npm install
    - npm run build
    {{- end }}
{{- else if eq .CI "circleci" }}
version: 2.1

jobs:
  build:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout

      {{- if eq .Language "go" }}
      - run:
          name: Install Go and Build
          command: |
            sudo apt update && sudo apt install -y golang
            go version
            go build -v ./...
      {{- else if eq .Language "python" }}
      - run:
          name: Install Python and Dependencies
          command: |
            sudo apt update && sudo apt install -y python3 python3-pip
            python3 --version
            pip3 install -r requirements.txt
      {{- else if eq .Language "js" }}
      - run:
          name: Install Node.js and Build
          command: |
            curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
            sudo apt install -y nodejs
            npm install
            npm run build
      {{- else if eq .Language "ts" }}
      - run:
          name: Install Node.js and Build (TS)
          command: |
            curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
            sudo apt install -y nodejs
            npm install
            npm run build
      {{- end }}

workflows:
  version: 2
  build:
    jobs:
      - build
{{- else if eq .CI "bitbucket-pipelines" }}
image: ubuntu:latest

pipelines:
  branches:
    main:
      - step:
          name: Build
          script:
            - apt update && apt install -y curl git

            {{- if eq .Language "go" }}
            - apt install -y golang
            - go version
            - go build -v ./...
            {{- else if eq .Language "python" }}
            - apt install -y python3 python3-pip
            - python3 --version
            - pip3 install -r requirements.txt
            {{- else if eq .Language "js" }}
            - curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
            - apt install -y nodejs
            - npm install
            - npm run build
            {{- else if eq .Language "ts" }}
            - curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
            - apt install -y nodejs
            - npm install
            - npm run build
            {{- end }}
{{- end }}